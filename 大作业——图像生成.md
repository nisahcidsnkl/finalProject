# 大作业——图像生成

## VAE

AE用于重构

![image-20250605152948806](https://hhq-notion.oss-cn-hangzhou.aliyuncs.com/dxl/image-20250605152948806.png)

VAE

![image-20250605153423531](https://hhq-notion.oss-cn-hangzhou.aliyuncs.com/dxl/image-20250605153423531.png)

## GAN

![image-20250605154025148](https://hhq-notion.oss-cn-hangzhou.aliyuncs.com/dxl/image-20250605154025148.png)

![image-20250605160123112](https://hhq-notion.oss-cn-hangzhou.aliyuncs.com/dxl/image-20250605160123112.png)

## Diffusion Model

![image-20250605163749433](https://hhq-notion.oss-cn-hangzhou.aliyuncs.com/dxl/image-20250605163749433.png)

## 大作业

![image-20250605164854693](https://hhq-notion.oss-cn-hangzhou.aliyuncs.com/dxl/image-20250605164854693.png)

实验主题：可控制要求的图像生成器
输入控制条件：文本

主实验方法：条件扩散模型 + CLIP 文本嵌入+Classifier-Free Guidance (CFG) +Attention Block

数据集：MNIST 跑通实验，调通后再切换 EMNIST 或 QuickDraw

对比实验：

| 模型                                    | 条件           | 对比点             |
| --------------------------------------- | -------------- | ------------------ |
| 条件扩散 + CLIP + CFG + Attention（A4） | 文本条件       | 效果基准           |
| 条件扩散（无 CFG / 无 Attention）（A1） | 文本条件       | 基础扩散效果       |
| CGAN                                    | 标签或文本编码 | GAN 的条件生成效果 |
| 无条件扩散（A0）                        | 无条件         | 验证条件的重要性   |

消融实验：

| A0   | 基础扩散模型          | ❌条件输入、❌CLIP、❌CFG、❌Attention | 无控制能力的基础扩散模型   |
| ---- | --------------------- | ---------------------------------- | -------------------------- |
| A1   | 条件扩散模型          | ✅条件输入、❌CLIP、❌CFG、❌Attention | 手动构造文本向量作为条件   |
| A2   | 条件扩散 + CLIP       | ✅条件输入、✅CLIP、❌CFG、❌Attention | 使用CLIP编码文本           |
| A3   | 条件扩散 + CLIP + CFG | ✅条件输入、✅CLIP、✅CFG、❌Attention | 加入CFG提高控制力          |
| A4   | 完整模型              | ✅条件输入、✅CLIP、✅CFG、✅Attention | 加入注意力机制增强建模能力 |

**不同 CFG scale 的影响**：

- **CFG scale = 1.0**、**CFG scale = 2.0**、**CFG scale = 3.0**：测试不同的 CFG 强度，查看它对条件一致性（即文本条件与生成图像的匹配度）和生成质量的影响。
- 目标：比较不同 CFG 的效果，评估哪个值能更好地控制生成结果。

评价指标（Matplotlib）：

生成图像的直观展示（拼图、样例）

训练损失曲线（收敛过程）：去噪 MSE（主损失）

FID 分数（可用现成工具，无需自己训练）

类别内均方像素差（MSE Diversity）

性能：采样速度、模型参数量

finalProject/
│
├── data/                        # 数据集相关目录
│   ├── MNIST/                   # 存放 MNIST 数据集原始文件或预处理数据
│   ├── EMNIST/                  # 存放 EMNIST 数据集原始文件或预处理数据
│   └── QuickDraw/               # 存放 QuickDraw 数据集原始文件或预处理数据
│
├── models/                      # 模型结构定义和权重加载相关代码
│   ├── diffusion/               # 扩散模型相关代码
│   │   ├── base.py              # 基础扩散模型（A0），无条件扩散生成器
│   │   ├── conditional.py       # 条件扩散模型（A1），支持标签条件
│   │   ├── clip_conditional.py  # 条件扩散+CLIP 模型（A2）
│   │   ├── cfg.py               # 条件扩散+CLIP+Classifier-Free Guidance 模型（A3）
│   │   └── attention.py         # 完整扩散模型（A4），包含注意力机制
│   ├── cgan/                    # CGAN 模型目录
│   │   └── cgan.py              # 条件生成对抗网络结构定义
│   └── clip/                    # CLIP 模型加载封装
│       └── clip.py              # 用于加载和封装预训练 CLIP 模型
│
├── configs/                     # 实验配置文件目录
│   ├── base.yaml                # 通用基础配置
│   ├── mnist.yaml               # MNIST 数据集实验配置
│   ├── emnist.yaml              # EMNIST 数据集实验配置
│   └── quickdraw.yaml           # QuickDraw 数据集实验配置
│
├── scripts/                     # 各类运行脚本
│   ├── train.py                 # 模型训练主脚本
│   ├── sample.py                # 采样/生成图片主脚本
│   ├── evaluate.py              # 模型评估脚本（计算 FID、MSE、CLIP 相似度等）
│   └── plot.py                  # 绘图脚本（绘制损失曲线、指标曲线等）
│
├── results/                     # 存放各实验运行结果
│   ├── A0_base/                 # A0: 基础扩散实验结果
│   │   ├── images/              # 实验生成图片
│   │   ├── plots/               # 实验损失曲线、指标曲线图
│   │   ├── metrics/             # 实验指标表格
│   │   │   ├── fid_scores.csv   # FID 分数记录
│   │   │   ├── mse_diversity.csv# MSE 多样性指标记录
│   │   │   └── clip_sim_scores.csv # CLIP 相似度指标记录
│   │   └── checkpoints/         # 模型权重文件
│
│   ├── A1_conditional/          # A1: 条件扩散实验结果
│   │   ├── images/              # 生成图片
│   │   ├── plots/               # 损失曲线、指标图
│   │   ├── metrics/             # 实验指标
│   │   │   ├── fid_scores.csv
│   │   │   ├── mse_diversity.csv
│   │   │   └── clip_sim_scores.csv
│   │   └── checkpoints/
│
│   ├── A2_clip/                 # A2: 条件扩散+CLIP 实验结果
│   │   ├── images/
│   │   ├── plots/
│   │   ├── metrics/
│   │   │   ├── fid_scores.csv
│   │   │   ├── mse_diversity.csv
│   │   │   └── clip_sim_scores.csv
│   │   └── checkpoints/
│
│   ├── A3_cfg/                  # A3: 条件扩散+CLIP+CFG 实验结果
│   │   ├── images/
│   │   ├── plots/
│   │   ├── metrics/
│   │   │   ├── fid_scores.csv
│   │   │   ├── mse_diversity.csv
│   │   │   └── clip_sim_scores.csv
│   │   └── checkpoints/
│
│   ├── A4_full/                 # A4: 完整模型实验结果
│   │   ├── images/
│   │   ├── plots/
│   │   ├── metrics/
│   │   │   ├── fid_scores.csv
│   │   │   ├── mse_diversity.csv
│   │   │   └── clip_sim_scores.csv
│   │   └── checkpoints/
│
│   ├── cgan/                    # CGAN 实验结果
│   │   ├── images/
│   │   ├── plots/
│   │   ├── metrics/
│   │   │   ├── fid_scores.csv
│   │   │   ├── mse_diversity.csv
│   │   │   └── clip_sim_scores.csv
│   │   └── checkpoints/
│
│   └── cfg_scale/               # 不同 CFG scale 参数实验结果
│       ├── images/
│       ├── plots/
│       ├── metrics/
│       │   ├── fid_scores.csv
│       │   ├── mse_diversity.csv
│       │   └── clip_sim_scores.csv
│       └── checkpoints/
│
├── utils/                       # 工具函数目录
│   ├── data_utils.py            # 数据加载、预处理工具
│   ├── metrics.py               # 指标计算工具 (FID, MSE, 多样性等)
│   ├── plot_utils.py            # 绘图工具函数
│   └── misc.py                  # 其他辅助工具函数
│
├── requirements.txt             # 项目依赖包列表 (pip 安装用)
├── README.md                    # 项目说明文档
└── main.py                      # 项目主入口脚本（可选集中入口）